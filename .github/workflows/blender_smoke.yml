name: Blender Smoke Test

on:
  push:
    branches: [ 'chore/lint-sweep' ]
  pull_request:
    branches: [ 'main' ]

jobs:
  blender-test:
    name: Run `blender_import_and_render.py`
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v4

      - name: Install Blender
        run: |
          sudo apt-get update
          sudo apt-get install -y blender

      - name: Create test SVG
        run: |
          mkdir -p Combination_Automotive_Diesel_Facility_Project/Python_Workflow/outputs
          cat > Combination_Automotive_Diesel_Facility_Project/Python_Workflow/test_input.svg <<'SVG'
<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">
  <rect x="10" y="10" width="80" height="80" fill="none" stroke="black"/>
</svg>
SVG

      - name: Run Blender script
        run: |
          blender --background --python Combination_Automotive_Diesel_Facility_Project/Python_Workflow/scripts/blender_import_and_render.py -- Combination_Automotive_Diesel_Facility_Project/Python_Workflow/test_input.svg Combination_Automotive_Diesel_Facility_Project/Python_Workflow/outputs/test_render.png --res 400 300

      - name: Verify render output
        run: |
          if [ ! -s Combination_Automotive_Diesel_Facility_Project/Python_Workflow/outputs/test_render.png ]; then
            echo "Rendered file missing or empty"; exit 2
          fi
